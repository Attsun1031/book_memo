# テストの柔軟性
### テストが脆くなる一般的な要因
* テストが、システム上の無関係なパーツやテスト対象オブジェクトの無関係な振る舞いと密に結合しすぎている
* テストが、対象コードに期待する振る舞いを必要以上に指定しており、必要以上の制約を課している
* テストに重複があり、複数のテストがプロダクションコードの同じ振る舞いを実装している

#### 設計上の原因
設計がテストの脆さの原因になることもある。  
あるオブジェクトをその環境から切り離せない理由が、依存関係が多すぎたり隠されてしまっているせいであるなど。

### テストを脆さから守る一言
**何が起こるべきなのかを性格に指定せよ。余計なことは一切指定するな。**

## 的確なアサーション
テストでは、その対象となるシナリオに関連する内容だけにアサーションの焦点を合わせること。  
テストによる入力とは関係のない値のアサーションや、他のテストでカバー済みの値のアサーションなどは避ける。

### 結果が複雑になる場合
結果として得られるオブジェクトが複雑になる場合でも、アサーションは単純に保つこと。

複雑になるケースは以下

#### 結果が構造化された値として定義されている
結果として得られたオブジェクトの全メンバーを比較するのではなく、その振る舞いで影響のある特定のメンバーのみ比較すること。

#### 文字列に関するアサーション
ログメッセージなど、メッセージをアサートするケース。  
文字列の完全一致をアサーションに書くと、その文字列の間にスペースがひとつたされたりするだけで失敗してしまう。

この場合、ある文字列がメッセージに含まれているかどうか、という観点に絞る。

##### 新たなオブジェクトの発見
このことは、ログメッセージ出力の指示と実際のフォーマットが同じレベルにいる、ということを表している。  
通知専用クラスを作ってフォーマットはそこに隠蔽してしまうのが良いのかも。

## モルモットオブジェクト
ポートとアダプタアーキテクチャにおいてアダプタのテストをする際、実際に存在するドメインモデルオブジェクトを使ってはならない。

例えばドメインモデルをXMLに変換するアダプタをテストする場合、特定のドメインモデルを使うと、そのドメインモデルの変更や削除にアダプタのテストが影響されてしまう。

このアダプタの責務は特定のドメインモデルの変換ではないので、テスト用のオブジェクトを用意してそれに対してテストするようにすべきである。